import{e as Ee,a4 as Se,j as H,o as S,w as T,D as q,F as qe,m as b,P as ie,s as we,y as le,z as x,B as L,S as M,aN as oe,v as j,am as ue,aO as de,A as xe,Q as w,aP as Ie,a as ae,q as v,c as $,l as W,b as Fe,d as P,t as z,aQ as je,aR as re,aS as se,H as ne,T as Be,aT as R,O as Ne,r as Q,aU as ke,aV as Oe,a7 as $e,a8 as Pe}from"#entry";import{d as ze}from"./BkDf-ezx.js";var Ae=Ee({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(r){const a=r;return Se(),(l,s)=>(S(),H(b(ie),qe(a,{onMousedown:s[0]||(s[0]=i=>{!i.defaultPrevented&&i.detail>1&&i.preventDefault()})}),{default:T(()=>[q(l.$slots,"default")]),_:3},16))}}),De=Ae;const Ce={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},Ke=["id"],Ve=["id"],We=["id"],Re=["id"],Ze={__name:"UFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(r){const a=r,l=we(),s=le(),i=x(()=>L({extend:L(Ce),...s.ui?.formField||{}})({size:a.size,required:a.required})),g=M(oe,null),f=x(()=>a.error||g?.value?.find(d=>d.name===a.name||a.errorPattern&&d.name?.match(a.errorPattern))?.message),u=j(ue()),h=u.value,B=M(de,void 0);return xe(u,()=>{B&&a.name&&(B.value[a.name]={id:u.value,pattern:a.errorPattern})},{immediate:!0}),w(je,u),w(Ie,x(()=>({error:f.value,name:a.name,size:a.size,eagerValidation:a.eagerValidation,validateOnInputDelay:a.validateOnInputDelay,errorPattern:a.errorPattern,hint:a.hint,description:a.description,help:a.help,ariaId:h}))),(d,D)=>(S(),H(b(ie),{as:r.as,class:v(i.value.root({class:[a.ui?.root,a.class]}))},{default:T(()=>[ae("div",{class:v(i.value.wrapper({class:a.ui?.wrapper}))},[r.label||l.label?(S(),$("div",{key:0,class:v(i.value.labelWrapper({class:a.ui?.labelWrapper}))},[Fe(b(De),{for:u.value,class:v(i.value.label({class:a.ui?.label}))},{default:T(()=>[q(d.$slots,"label",{label:r.label},()=>[P(z(r.label),1)])]),_:3},8,["for","class"]),r.hint||l.hint?(S(),$("span",{key:0,id:`${b(h)}-hint`,class:v(i.value.hint({class:a.ui?.hint}))},[q(d.$slots,"hint",{hint:r.hint},()=>[P(z(r.hint),1)])],10,Ke)):W("",!0)],2)):W("",!0),r.description||l.description?(S(),$("p",{key:1,id:`${b(h)}-description`,class:v(i.value.description({class:a.ui?.description}))},[q(d.$slots,"description",{description:r.description},()=>[P(z(r.description),1)])],10,Ve)):W("",!0)],2),ae("div",{class:v([(r.label||!!l.label||r.description||!!l.description)&&i.value.container({class:a.ui?.container})])},[q(d.$slots,"default",{error:f.value}),typeof f.value=="string"&&f.value||l.error?(S(),$("div",{key:0,id:`${b(h)}-error`,class:v(i.value.error({class:a.ui?.error}))},[q(d.$slots,"error",{error:f.value},()=>[P(z(f.value),1)])],10,We)):r.help||l.help?(S(),$("div",{key:1,id:`${b(h)}-help`,class:v(i.value.help({class:a.ui?.help}))},[q(d.$slots,"help",{help:r.help},()=>[P(z(r.help),1)])],10,Re)):W("",!0)],2)]),_:3},8,["as","class"]))}};function Te(r){return"schema"in r&&typeof r.coercer=="function"&&typeof r.validator=="function"&&typeof r.refiner=="function"}function Le(r){return"~standard"in r}async function Me(r,a){const l=await a["~standard"].validate(r);return l.issues?{errors:l.issues?.map(s=>({name:s.path?.map(i=>typeof i=="object"?i.key:i).join(".")||"",message:s.message}))||[],result:null}:{errors:null,result:l.value}}async function Ue(r,a){const[l,s]=a.validate(r);return l?{errors:l.failures().map(g=>({message:g.message,name:g.path.join(".")})),result:null}:{errors:null,result:s}}function Qe(r,a){if(Le(a))return Me(r,a);if(Te(a))return Ue(r,a);throw new Error("Form validation failed: Unsupported form schema")}function He(r,a){return a?a.split(".").reduce((s,i)=>s?.[i],r):r}function Ge(r,a,l){if(!a)return Object.assign(r,l);if(!r)return r;const s=a.split(".");let i=r;for(let f=0;f<s.length-1;f++){const u=s[f];(i[u]===void 0||i[u]===null)&&(f+1<s.length&&!Number.isNaN(Number(s[f+1]))?i[u]=[]:i[u]={}),i=i[u]}const g=s[s.length-1];return i[g]=l,r}class A extends Error{formId;errors;constructor(a,l){super("Form validation exception"),this.formId=a,this.errors=l,Object.setPrototypeOf(this,A.prototype)}}const Je={base:""},_e={__name:"UForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:null,required:!1},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},name:{type:null,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},nested:{type:null,required:!1},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(r,{expose:a,emit:l}){const s=r,i=l,g=le(),f=x(()=>L({extend:L(Je),...g.ui?.form||{}})),u=s.id??ue(),h=ze(`form-${u}`),B=s.nested?.toString()===""||s.nested===!0,d=B&&M(re,void 0),D=B?M(se,void 0):void 0,N=x(()=>D?.value?s.name?He(D.value,s.name):D.value:s.state);w(re,h),w(se,N);const k=j(new Map);ne(async()=>{d&&(await Be(),d.emit({type:"attach",validate:O,formId:u,name:s.name,api:te}))}),Ne(()=>{h.reset(),d&&d.emit({type:"detach",formId:u})}),ne(async()=>{h.on(async e=>{e.type==="attach"?k.value.set(e.formId,{validate:e.validate,name:e.name,api:e.api}):e.type==="detach"?k.value.delete(e.formId):s.validateOn?.includes(e.type)&&!I.value&&(e.type!=="input"?await O({name:e.name,silent:!0,nested:!1}):(e.eager||U.has(e.name))&&await O({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&U.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&G.add(e.name),(e.type==="change"||e.type==="input")&&K.add(e.name)})});const c=j([]);w(oe,c);const C=j({});w(de,C);const K=Q(new Set),G=Q(new Set),U=Q(new Set);function J(e){return e.map(t=>({...t,id:t?.name?C.value[t.name]?.id:void 0}))}const V=j(null);async function ce(){let e=s.validate?await s.validate(N.value)??[]:[];if(s.schema){const{errors:t,result:n}=await Qe(N.value,s.schema);t?e=e.concat(t):V.value=n}return J(e)}async function O(e={silent:!1,nested:!1,transform:!1}){const t=e.name&&!Array.isArray(e.name)?[e.name]:e.name;let n=[],o=[];if(!t&&e.nested){const E=Array.from(k.value.values()).map(y=>fe(y,e)),p=await Promise.all(E);o=p.filter(y=>y.error).flatMap(y=>y.error.errors.map(ge=>me(ge,y.name))),n=p.filter(y=>y.output!==void 0)}const F=[...await ce(),...o];if(t?c.value=he(F,t):c.value=F,c.value?.length){if(e.silent)return!1;throw new A(u,c.value)}return e.transform?(n.forEach(E=>{E.name?Ge(V.value,E.name,E.output):Object.assign(V.value,E.output)}),V.value??N.value):N.value}const I=j(!1);w(ke,R(I));async function X(e){I.value=s.loadingAuto&&!0;const t=e;try{t.data=await O({nested:!0,transform:s.transform}),await s.onSubmit?.(t),K.clear()}catch(n){if(!(n instanceof A))throw n;const o={...t,errors:n.errors};i("error",o)}finally{I.value=!1}}const Y=x(()=>s.disabled||I.value);w(Oe,x(()=>({disabled:Y.value,validateOnInputDelay:s.validateOnInputDelay})));async function fe(e,t){try{const n=await e.validate({...t,silent:!1});return{name:e.name,output:n}}catch(n){if(!(n instanceof A))throw n;return{name:e.name,error:n}}}function me(e,t){return!t||!e.name?e:{...e,name:t+"."+e.name}}function pe(e,t){const n=t+".",o=e?.name?.startsWith(n)?e.name.substring(n.length):e.name;return{...e,name:o}}function ye(e,t){return t?e.filter(n=>n?.name?.startsWith(t+".")).map(n=>pe(n,t)):e}function Z(e){return e.api.getErrors().map(t=>e.name?{...t,name:e.name+"."+t.name}:t)}function _(e,t){return!e||!t?!0:e instanceof RegExp?e.test(t):t===e||typeof e=="string"&&e.startsWith(t+".")}function ve(e,t){if(!e||e instanceof RegExp)return e;if(t!==e)return typeof e=="string"&&e.startsWith(t+".")?e.substring(t.length+1):e}function he(e,t){const n=new Set(t),o=t.map(p=>C.value?.[p]?.pattern).filter(Boolean),m=p=>p.name?n.has(p.name)?!0:o.some(y=>y.test(p.name)):!1,F=c.value.filter(p=>!m(p)),E=e.filter(m);return[...F,...E]}function be(e,t){return e.filter(n=>t instanceof RegExp?!(n.name&&t.test(n.name)):!n.name||n.name!==t)}function ee(e){return!e.name||!!C.value[e.name]}const te={validate:O,errors:c,setErrors(e,t){const n=J(e.filter(ee)),o=[];for(const m of k.value.values())if(_(t,m.name)){const F=ye(e,m.name);m.api.setErrors(F,ve(t,m.name||"")),o.push(...Z(m))}if(t){const m=be(c.value,t);c.value=[...m,...n,...o]}else c.value=[...n,...o]},async submit(){await X(new Event("submit"))},getErrors(e){return e?c.value.filter(t=>e instanceof RegExp?t.name&&e.test(t.name):t.name===e):c.value},clear(e){const t=e?c.value.filter(o=>ee(o)&&(e instanceof RegExp?!(o.name&&e.test(o.name)):o.name!==e)):[],n=[];for(const o of k.value.values())_(e,o.name)&&o.api.clear(),n.push(...Z(o));c.value=[...t,...n]},disabled:Y,loading:I,dirty:x(()=>!!K.size),dirtyFields:R(K),blurredFields:R(U),touchedFields:R(G)};return a(te),(e,t)=>(S(),H(Pe(b(d)?"div":"form"),{id:b(u),class:v(f.value({class:s.class})),onSubmit:$e(X,["prevent"])},{default:T(()=>[q(e.$slots,"default",{errors:c.value,loading:I.value})]),_:3},40,["id","class"]))}};export{De as L,Ze as _,_e as a};
