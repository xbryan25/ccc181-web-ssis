import{e as Ee,$ as we,j as Q,o as w,w as T,D as q,F as qe,m as b,P as ie,s as Se,y as le,z as x,B as L,S as M,at as oe,v as B,au as ue,av as ce,A as xe,Q as S,aw as Ie,a as re,q as v,c as O,l as W,b as Fe,d as z,t as A,ax as Be,ay as ae,az as se,H as ne,T as je,aA as R,O as ke,r as H,aB as Ne,aC as $e,ak as Oe,am as ze}from"#entry";import{a as Ae}from"./CEXf0e8F.js";var Pe=Ee({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(a){const r=a;return we(),(l,s)=>(w(),Q(b(ie),qe(r,{onMousedown:s[0]||(s[0]=i=>{!i.defaultPrevented&&i.detail>1&&i.preventDefault()})}),{default:T(()=>[q(l.$slots,"default")]),_:3},16))}}),Ce=Pe;const De={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},Ke=["id"],Ve=["id"],We=["id"],Re=["id"],Ze={__name:"UFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(a){const r=a,l=Se(),s=le(),i=x(()=>L({extend:L(De),...s.ui?.formField||{}})({size:r.size,required:r.required})),g=M(oe,null),f=x(()=>r.error||g?.value?.find(c=>c.name===r.name||r.errorPattern&&c.name?.match(r.errorPattern))?.message),u=B(ue()),h=u.value,j=M(ce,void 0);return xe(u,()=>{j&&r.name&&(j.value[r.name]={id:u.value,pattern:r.errorPattern})},{immediate:!0}),S(Be,u),S(Ie,x(()=>({error:f.value,name:r.name,size:r.size,eagerValidation:r.eagerValidation,validateOnInputDelay:r.validateOnInputDelay,errorPattern:r.errorPattern,hint:r.hint,description:r.description,help:r.help,ariaId:h}))),(c,C)=>(w(),Q(b(ie),{as:a.as,class:v(i.value.root({class:[r.ui?.root,r.class]}))},{default:T(()=>[re("div",{class:v(i.value.wrapper({class:r.ui?.wrapper}))},[a.label||l.label?(w(),O("div",{key:0,class:v(i.value.labelWrapper({class:r.ui?.labelWrapper}))},[Fe(b(Ce),{for:u.value,class:v(i.value.label({class:r.ui?.label}))},{default:T(()=>[q(c.$slots,"label",{label:a.label},()=>[z(A(a.label),1)])]),_:3},8,["for","class"]),a.hint||l.hint?(w(),O("span",{key:0,id:`${b(h)}-hint`,class:v(i.value.hint({class:r.ui?.hint}))},[q(c.$slots,"hint",{hint:a.hint},()=>[z(A(a.hint),1)])],10,Ke)):W("",!0)],2)):W("",!0),a.description||l.description?(w(),O("p",{key:1,id:`${b(h)}-description`,class:v(i.value.description({class:r.ui?.description}))},[q(c.$slots,"description",{description:a.description},()=>[z(A(a.description),1)])],10,Ve)):W("",!0)],2),re("div",{class:v([(a.label||!!l.label||a.description||!!l.description)&&i.value.container({class:r.ui?.container})])},[q(c.$slots,"default",{error:f.value}),typeof f.value=="string"&&f.value||l.error?(w(),O("div",{key:0,id:`${b(h)}-error`,class:v(i.value.error({class:r.ui?.error}))},[q(c.$slots,"error",{error:f.value},()=>[z(A(f.value),1)])],10,We)):a.help||l.help?(w(),O("div",{key:1,id:`${b(h)}-help`,class:v(i.value.help({class:r.ui?.help}))},[q(c.$slots,"help",{help:a.help},()=>[z(A(a.help),1)])],10,Re)):W("",!0)],2)]),_:3},8,["as","class"]))}};function Te(a){return"schema"in a&&typeof a.coercer=="function"&&typeof a.validator=="function"&&typeof a.refiner=="function"}function Le(a){return"~standard"in a}async function Me(a,r){const l=await r["~standard"].validate(a);return l.issues?{errors:l.issues?.map(s=>({name:s.path?.map(i=>typeof i=="object"?i.key:i).join(".")||"",message:s.message}))||[],result:null}:{errors:null,result:l.value}}async function Ue(a,r){const[l,s]=r.validate(a);return l?{errors:l.failures().map(g=>({message:g.message,name:g.path.join(".")})),result:null}:{errors:null,result:s}}function He(a,r){if(Le(r))return Me(a,r);if(Te(r))return Ue(a,r);throw new Error("Form validation failed: Unsupported form schema")}function Qe(a,r){return r?r.split(".").reduce((s,i)=>s?.[i],a):a}function Ge(a,r,l){if(!r)return Object.assign(a,l);if(!a)return a;const s=r.split(".");let i=a;for(let f=0;f<s.length-1;f++){const u=s[f];(i[u]===void 0||i[u]===null)&&(f+1<s.length&&!Number.isNaN(Number(s[f+1]))?i[u]=[]:i[u]={}),i=i[u]}const g=s[s.length-1];return i[g]=l,a}class P extends Error{formId;errors;constructor(r,l){super("Form validation exception"),this.formId=r,this.errors=l,Object.setPrototypeOf(this,P.prototype)}}const Je={base:""},_e={__name:"UForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:null,required:!1},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},name:{type:null,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},nested:{type:null,required:!1},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(a,{expose:r,emit:l}){const s=a,i=l,g=le(),f=x(()=>L({extend:L(Je),...g.ui?.form||{}})),u=s.id??ue(),h=Ae(`form-${u}`),j=s.nested?.toString()===""||s.nested===!0,c=j&&M(ae,void 0),C=j?M(se,void 0):void 0,k=x(()=>C?.value?s.name?Qe(C.value,s.name):C.value:s.state);S(ae,h),S(se,k);const N=B(new Map);ne(async()=>{c&&(await je(),c.emit({type:"attach",validate:$,formId:u,name:s.name,api:te}))}),ke(()=>{h.reset(),c&&c.emit({type:"detach",formId:u})}),ne(async()=>{h.on(async e=>{e.type==="attach"?N.value.set(e.formId,{validate:e.validate,name:e.name,api:e.api}):e.type==="detach"?N.value.delete(e.formId):s.validateOn?.includes(e.type)&&!I.value&&(e.type!=="input"?await $({name:e.name,silent:!0,nested:!1}):(e.eager||U.has(e.name))&&await $({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&U.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&G.add(e.name),(e.type==="change"||e.type==="input")&&K.add(e.name)})});const d=B([]);S(oe,d);const D=B({});S(ce,D);const K=H(new Set),G=H(new Set),U=H(new Set);function J(e){return e.map(t=>({...t,id:t?.name?D.value[t.name]?.id:void 0}))}const V=B(null);async function de(){let e=s.validate?await s.validate(k.value)??[]:[];if(s.schema){const{errors:t,result:n}=await He(k.value,s.schema);t?e=e.concat(t):V.value=n}return J(e)}async function $(e={silent:!1,nested:!1,transform:!1}){const t=e.name&&!Array.isArray(e.name)?[e.name]:e.name;let n=[],o=[];if(!t&&e.nested){const E=Array.from(N.value.values()).map(y=>fe(y,e)),p=await Promise.all(E);o=p.filter(y=>y.error).flatMap(y=>y.error.errors.map(ge=>me(ge,y.name))),n=p.filter(y=>y.output!==void 0)}const F=[...await de(),...o];if(t?d.value=he(F,t):d.value=F,d.value?.length){if(e.silent)return!1;throw new P(u,d.value)}return e.transform?(n.forEach(E=>{E.name?Ge(V.value,E.name,E.output):Object.assign(V.value,E.output)}),V.value??k.value):k.value}const I=B(!1);S(Ne,R(I));async function X(e){I.value=s.loadingAuto&&!0;const t=e;try{t.data=await $({nested:!0,transform:s.transform}),await s.onSubmit?.(t),K.clear()}catch(n){if(!(n instanceof P))throw n;const o={...t,errors:n.errors};i("error",o)}finally{I.value=!1}}const Y=x(()=>s.disabled||I.value);S($e,x(()=>({disabled:Y.value,validateOnInputDelay:s.validateOnInputDelay})));async function fe(e,t){try{const n=await e.validate({...t,silent:!1});return{name:e.name,output:n}}catch(n){if(!(n instanceof P))throw n;return{name:e.name,error:n}}}function me(e,t){return!t||!e.name?e:{...e,name:t+"."+e.name}}function pe(e,t){const n=t+".",o=e?.name?.startsWith(n)?e.name.substring(n.length):e.name;return{...e,name:o}}function ye(e,t){return t?e.filter(n=>n?.name?.startsWith(t+".")).map(n=>pe(n,t)):e}function Z(e){return e.api.getErrors().map(t=>e.name?{...t,name:e.name+"."+t.name}:t)}function _(e,t){return!e||!t?!0:e instanceof RegExp?e.test(t):t===e||typeof e=="string"&&e.startsWith(t+".")}function ve(e,t){if(!e||e instanceof RegExp)return e;if(t!==e)return typeof e=="string"&&e.startsWith(t+".")?e.substring(t.length+1):e}function he(e,t){const n=new Set(t),o=t.map(p=>D.value?.[p]?.pattern).filter(Boolean),m=p=>p.name?n.has(p.name)?!0:o.some(y=>y.test(p.name)):!1,F=d.value.filter(p=>!m(p)),E=e.filter(m);return[...F,...E]}function be(e,t){return e.filter(n=>t instanceof RegExp?!(n.name&&t.test(n.name)):!n.name||n.name!==t)}function ee(e){return!e.name||!!D.value[e.name]}const te={validate:$,errors:d,setErrors(e,t){const n=J(e.filter(ee)),o=[];for(const m of N.value.values())if(_(t,m.name)){const F=ye(e,m.name);m.api.setErrors(F,ve(t,m.name||"")),o.push(...Z(m))}if(t){const m=be(d.value,t);d.value=[...m,...n,...o]}else d.value=[...n,...o]},async submit(){await X(new Event("submit"))},getErrors(e){return e?d.value.filter(t=>e instanceof RegExp?t.name&&e.test(t.name):t.name===e):d.value},clear(e){const t=e?d.value.filter(o=>ee(o)&&(e instanceof RegExp?!(o.name&&e.test(o.name)):o.name!==e)):[],n=[];for(const o of N.value.values())_(e,o.name)&&o.api.clear(),n.push(...Z(o));d.value=[...t,...n]},disabled:Y,loading:I,dirty:x(()=>!!K.size),dirtyFields:R(K),blurredFields:R(U),touchedFields:R(G)};return r(te),(e,t)=>(w(),Q(ze(b(c)?"div":"form"),{id:b(u),class:v(f.value({class:s.class})),onSubmit:Oe(X,["prevent"])},{default:T(()=>[q(e.$slots,"default",{errors:d.value,loading:I.value})]),_:3},40,["id","class"]))}};export{Ze as _,_e as a};
